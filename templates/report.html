<style>
    .placehodler {
        height: 200px;
    }
</style>
<div class="ui segment basic container report">
    <div class="ui breadcrumb">
        <a class="section">{{CONST.APP_NAME}}</a>
        <i class="right angle icon divider"></i>
        <div class="active section">Report</div>
    </div>
    <div class="title" data-bind="html: ReportTitle"></div>
    <div class="sub-title">
        <div>
            <span class="data-source">
                <span class="caption forum">Data Source:</span>
            <span class="icon" data-bind="html: ForumName, style: { backgroundImage: ForumIconUrl }"></span>
            </span>
            <span class="date-range" data-bind="html: DateRangeHtml"></span>
        </div>
        <div class="data-source">
            <span class="caption">Search Phrase:</span>
            <span data-bind="html: Search"></span>
        </div>
    </div>
    <div class="section summary">
        <div class="brand"></div>
        <table>
            <tr>
                <td>
                    <div class="card" style="color: #6435C9;">
                        <div class="caption">Message Posts</div>
                        <span data-bind="html: ThreadCountText"></span>
                    </div>
                </td>
                <td>
                    <div class="card" style="color: #FBBD08;">
                        <div class="caption">
                            Influence of Users
                            <br />(Page View)
                        </div>
                        <span data-bind="html: TotalViewCountText"></span>
                    </div>
                </td>
                <td>
                    <div class="card" style="color: #F2711C;">
                        <div class="caption">Unique Users of Posts</div>
                        <span data-bind="html: UserCountText"></span>
                    </div>
                </td>
                <td>
                    <div class="card" style="color: #B5CC18;">
                        <div class="caption">Regions of Users</div>
                        <span data-bind="html: RegionCountText"></span>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div class="section flexible sentiment collapsed">
        <div class="brand" data-bind="events: { click: OnSectionStretch }">
            <span class="arrow"></span>
        </div>
        <div class="content placehodler"></div>
    </div>
    <div class="section flexible services expanded">
        <div class="brand" data-bind="events: { click: OnSectionStretch }">
            <span class="arrow"></span>
        </div>
        <div class="content">
            <div id="chartMentionedServices" style="width: 400px; height: 300px;"></div>
        </div>
    </div>
    <div class="section flexible users collapsed">
        <div class="brand" data-bind="events: { click: OnSectionStretch }">
            <span class="arrow"></span>
        </div>
        <div class="content placehodler"></div>
    </div>
    <div class="section flexible world collapsed">
        <div class="brand" data-bind="events: { click: OnSectionStretch }">
            <span class="arrow"></span>
        </div>
        <div class="content placehodler"></div>
    </div>
</div>
<script type="text/javascript">
    var scope = angular.element("html").scope();
    var model = kendo.data.Model.define({
        fields: {
            ReportTitle: { type: "string" },
            Forum: { type: "string" },
            StartTime: { type: "date" },
            EndTime: { type: "date" },
            Search: { type: "string", defaultValue: "N/A" },

            ThreadCount: { type: "number" },
            TotalViewCount: { type: "number" },
            UserCount: { type: "number" },
            RegionCount: { type: "number" }
        },
        OnSectionStretch: function (e) {
            var section = $(e.target).parent();
            while (section && (section.is(".section.flexible") == false)) {
                section = section.parent();
            }
            if (section) {
                if (section.is(".collapsed")) {
                    section.addClass("expanded");
                    section.removeClass("collapsed");
                } else if (section.is(".expanded")) {
                    section.addClass("collapsed");
                    section.removeClass("expanded");
                }
            }
        }
    });
    var viewModel = kendo.observable(new model());
    var formatOptions = {
        Forum: function (model) {
            model.set("ForumName", scope.CONST.ALL_ENABLED_PLARFORMS[model.Forum] || model.Forum);
            model.set("ForumIconUrl", "url('public/images/" + model.Forum + ".png')");
        },
        _UpdateDateRageHtml: function (model) {
            var html = "N/A";
            if (model.StartTime) {
                if (model.EndTime) {
                    html = "Date Range: "
                        + kendo.toString(model.StartTime, "M/d/yyyy h:mm:ss tt")
                        + " to "
                        + kendo.toString(model.EndTime, "M/d/yyyy h:mm:ss tt");
                }
                else {
                    html = "Date: "
                        + kendo.toString(model.StartTime, "M/d/yyyy h:mm:ss tt");
                }
            }
            model.set("DateRangeHtml", html);
        },
        StartTime: function (model) {
            this._UpdateDateRageHtml(model);
        },
        EndTime: function (model) {
            this._UpdateDateRageHtml(model);
        },
        Search: function (model) {
            if ((model.Search === null) || (model.Search.length === 0)) {
                model.set("Search", "N/A");
            }
        },
        _FormatNumber: function (number) {
            if ($.isNumeric(number) === false) { return "N/A"; }
            if (number < 1000) { return number; }
            var suffixes = ['k', 'M', 'G', 'T', 'P', 'E'];
            var exp = Math.floor(Math.log(number) / Math.log(1000));
            return /(^.+\.((0*[1-9]+)|0))0*$/g.exec((number / Math.pow(1000, exp)).toFixed(3))[1] + suffixes[exp - 1];
        },
        ThreadCount: function (model) {
            model.set("ThreadCountText", this._FormatNumber(model.ThreadCount));
        },
        TotalViewCount: function (model) {
            model.set("TotalViewCountText", this._FormatNumber(model.TotalViewCount));
        },
        UserCount: function (model) {
            model.set("UserCountText", this._FormatNumber(model.UserCount));
        },
        RegionCount: function (model) {
            model.set("RegionCountText", this._FormatNumber(model.RegionCount));
        },
        MentionedServices: function (model) {
            var chart = echarts.init($("#chartMentionedServices")[0]);
            chart.setOption({
                title: {
                    textStyle: {
                        fontSize: 13
                    },
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{b} : {c}"
                },
                series: {
                    type: 'wordCloud',
                    gridSize: 0,
                    sizeRange: [12, 24],
                    textStyle: {
                        normal: {
                            color: function () {
                                return 'rgb(' + [
                                    Math.round(Math.random() * 160),
                                    Math.round(Math.random() * 160),
                                    Math.round(Math.random() * 160)
                                ].join(',') + ')';
                            }
                        },
                        emphasis: {
                            shadowBlur: 10,
                            shadowColor: '#333'
                        }
                    },
                    data: [{
                        name: "Azure Active Directory", value: 2000
                    }, {
                        name: "Virtual Machines", value: 1879
                    }, {
                        name: "Azure Function", value: 1788
                    }, {
                        name: "Storage", value: 1723
                    }, {
                        name: "Web Apps", value: 1654
                    }, {
                        name: "Service Fabric", value: 1598
                    }, {
                        name: "App Service", value: 1532
                    }, {
                        name: "Mobile Apps", value: 1484
                    }, {
                        name: "SQL Database", value: 1112
                    }, {
                        name: "Data Lake Store", value: 965
                    }, {
                        name: "Data Factory", value: 847
                    }, {
                        name: "Azure Cosmos DB", value: 582
                    }, {
                        name: "Application Insights", value: 555
                    }, {
                        name: "Service Bus", value: 550
                    }, {
                        name: "Visual Studio Team Services", value: 462
                    }, {
                        name: "Blob Storage", value: 366
                    }, {
                        name: "HDInsight", value: 360
                    }, {
                        name: "IoT Hub", value: 282
                    }, {
                        name: "Load Balancer", value: 273
                    }, {
                        name: "Event Hubs", value: 265
                    }]
                }
            });
        }
    };
    viewModel.bind("change", function (e) {
        if (e.field in formatOptions) {
            formatOptions[e.field](this);
        }
    });
    kendo.bind($(".ui.basic.container"), viewModel);

    viewModel.set("ReportTitle", "Volumes and Spikes Report (Demo)");
    viewModel.set("Forum", "so");
    viewModel.set("StartTime", "2017-01-20 21:16:55");
    viewModel.set("EndTime", "2017-02-11 08:50:23");
    viewModel.set("ThreadCount", 1457800);
    viewModel.set("TotalViewCount", 12300);
    viewModel.set("UserCount", 581230);
    viewModel.set("RegionCount", 989);
    viewModel.set("MentionedServices", 0);
</script>